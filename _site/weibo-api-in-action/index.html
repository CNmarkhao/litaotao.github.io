<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>［touch spark］6. 终于等到你，spark streaming + 新浪微博数据 | Taotao's Zone</title>
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="/css/default.css" type="text/css" />
  <link rel="stylesheet" href="/css/desktop.css" type="text/css" />
  <link rel="stylesheet" href="/css/mobile.css" type="text/css" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
  <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/js/jquery-migrate-1.2.1.js" type="text/javascript"></script>
  <script src="/js/jquery.transit.min.js" type="text/javascript"></script>
  <script src="/js/common.js" type="text/javascript"></script>
</head>
<body>
  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
  html {
    /*background: url() no-repeat center center fixed;*/
    background: #333333;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  body { background:transparent; }
  @media screen and (max-width: 750px){
    body { background: rgba(255, 255, 255, 0.9); }
  }
</style>

<div id="content" class="post" style="margin-top: 20px;">
  <div id="avatar" class="avatar circle" data-in-right="false" style="width: 150px; height: 150px; position: fixed; top: 40px; z-index: 99; opacity: 0;">
    <div class="center" style="margin-top: 4px; height: 142px; width: 142px; border-radius: 71px; background-image: url('../images/2.jpg');"></div>
  </div>

  <div class="entry" style="position: relative;">
    <h1 class="entry-title"><a href="/weibo-api-in-action" title="［touch spark］6. 终于等到你，spark streaming + 新浪微博数据">［touch spark］6. 终于等到你，spark streaming + 新浪微博数据</a></h1>

    <p class="entry-date">2015-01-05 <span class="lastModified" style="display: none;" data-source="_posts/spark/2015-01-05-weibo-api-in-action.md">最后更新时间: </span></p>

    <p>注：与本文相关的所有源代码已放在最最喜爱的 <a href="https://github.com/litaotao/weibostreaming">Github</a> 上。</p>

<h2></h2>

<h2>1. 写在前面</h2>

<p>　　从最开始想尝试streaming的时候，我一心想实现databricks在spark summit 2014上的那个演示---实时获取twiiter数据，并做分析展示。无奈，在折腾twitter几天后只得放弃。刚开始注册twitter得需要手机号，可是twitter居然不支持中国内地的号码，这里不知道是twitter不支持，还是中国内地的运营商不支持twitter，我想应该是后者吧。当时纠结了好久，一种心碎的感觉。后来终于突然有一天无需手机号也能注册了，我欣喜若狂地注册了一个twitter号，后来发现尼玛新建一个twitter app需要手机验证，这下我就完全down机了，无奈，twitter这条路是完全走不通了。这段时间的心情，就像过山车一样，从心碎到兴奋再到最后的心死。<br/>
<img src="../../images/guoshanche.gif" alt="过山车" />
　　可是我不死心啊，还行想玩玩streaming，想体验体验streaming的power，怎么办怎么办？我左思右想，想要做到databricks的效果，唯一的办法就是利用咱们天朝的新浪微博了。在调研了一下新浪微博的API后，其原理和twitter API的原理也是一样的，但是新浪微博的streaming API被取消了。好吧，硬骨头挺多，还得自己啃了。没办法，我想了想，就2个选择，要么不做，然后天天后悔；要么做，然后天天折腾。好吧，我承认我还是义无返顾地选择了第二条路，sigh。<br/>
　　在写这篇博客的时候看到徐静蕾的新片《有一个地方只有我们知道》，里面一句话让我深有感触---<strong>没有在一起的，就是不对的人，对的人，你是不会失去他的</strong>，我也想说，没有学到的技术，就是你不喜爱的技术，喜欢的技术，你是不可能学不会的。</p>

<h2>2. 实验目的</h2>

<p>　　这次实验是想尝试一下spark streaming的效果，预期是这样的：通过每隔 <strong>几秒</strong> 从新浪微博拿到 <strong>一些</strong> 公开的微博数据，然后实时 <strong>处理</strong> 一下这些数据并 <strong>展现</strong> 出来。<br/>
　　ok，这里的关键上面已经用粗体标记出来了。有两个方面，一是时间间隔的设置，数据流量的设置，这关系到streaming的稳定性，比如说若处理速度小于数据流入的速度的话，那数据会慢慢堆积起来；若数据流入速度小于处理速度的话，展现处理结果肯定也不好看。这里是属于tuning的环境，可以在spark官网上仔细瞧瞧，不过具体还是要根据应用需求来定。第二个方面是数据处理和展示，这应该是应用的核心了。这里我们做得很初级，简单做一些TF-IDF的测试或者是更简单的包含性测试。 <br/>
　　既然是第一次，那就不要太那啥，还是温柔一点比较好。暂时定一个目标，我们想看看实时微博中哪些是包含某某字段的，然后输出这些微博的信息。比如说，我想知道实时微博中，哪些是包含 <strong>建设银行</strong>，<strong>涨</strong> 这样两个关键字的微博，并实时打印出来。</p>

<h2>3. streaming，我的目标</h2>

<p>　　既然要玩，那就玩得痛快点，下面是我准备在微博streaming这块做的一些各个版本的安排：</p>

<ul>
<li>数据方面：

<ul>
<li>第一步，能够获取微博伪实时数据即可【微博API请求有限制】；</li>
<li>第二步，自己设计一个搜集系统，能获取近实时的微博数据，希望能媲美原来微博的streaming API；</li>
</ul>
</li>
<li>应用方面：

<ul>
<li>第一步，啥都不干，确认spark   cluster能连到我的数据源，把所有接收到的数据简单打印出来；</li>
<li>第二步，简单处理，对实时数据流进行一个简单的filter操作，比如说，看看哪些消息是提到了某人，或某支股票；</li>
<li>第三步，复杂一点，用用MLib来对每条消息学习一下，其实就是高级的filter；</li>
</ul>
</li>
</ul>


<p>　　目前我打算从上面几个小目标一点一点上，最近发现一个NB项目，Zeppelin，底层可以集成spark，届时看看是否有需要，可以尝试下
eppelin+spark。【最近我尝试编译过Zeppelin，遇到很多问题，目前这个项目还不是很成熟，不过项目组说了，他们正在迁移到Apache的孵化器中，完成迁移后会专心发布新版本。Good，看来的确是一个NB项目】 <br/>
　　冲啊，每天进步一点点。
<img src="../../images/stepbystep.jpg" alt="每天进步一点点咯" /></p>

<h2>4. 步骤规划</h2>

<p>　　我们第一次的目标很简单，我准备在数据方面，简单地完成第一步；在应用方面，也是简单地完成第一步，算是一个最小的MVP了，暂定为MVP 0.1.0
吧，哈哈。好，现在简单地分析下，大概有下面几个步骤：</p>

<ul>
<li>获取数据，通过新浪微博API，这里需要我们设计一个数据收集器</li>
<li>发送/接收数据，因为我改用Python来玩spark了，目前spark 1.2版的python streaming只支持socket包，当然socket包也是最简单的了，所以我准备用socket方式进行数据的收发。So，这里我们需要写一个简单的Socket Server</li>
<li>展示数据，简单的打印下来即可</li>
</ul>


<p>　　下面，我们就按照MVP 0.1.0 的步骤规划，一步一步来搞定咱们这个小系统。</p>

<h2>5. 获取数据：新浪微博API使用</h2>

<p>　　微博官方已经有详细的新手引导了，这里就不重复造轮子了，大家可以直接参考 <a href="http://open.weibo.com/wiki/%E6%96%B0%E6%89%8B%E6%8C%87%E5%8D%97">这里</a>  <br/>
　　我用的是<a href="https://github.com/michaelliao/sinaweibopy">Python SDK</a></p>

<h2>6. 收发数据：Socket Server</h2>

<h2>7. 展示数据: Just print</h2>


    <div id="disqus_container">
      <div style="margin-bottom:20px">
      <!-- 多说评论框 start -->
        <div class="ds-thread" data-thread-key=/weibo-api-in-action data-title=［touch spark］6. 终于等到你，spark streaming + 新浪微博数据 data-url=/weibo-api-in-action></div>
      <!-- 多说评论框 end -->
      <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"litaotao"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0] 
           || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
      <!-- 多说公共JS代码 end -->
      </div>
    </div>
  </div>

  <div id="menuIndex" class="sidenav">
    <div class="myinfo"><center>
      <div id="avatarHolder" class="avatar circle" style="width: 0px; height: 0px; box-shadow: none; margin-bottom: 20px;"></div>
      <a href="/index.html" title="Homepage"><i class="icon-home icon-large"></i> Home</a>
      <a href="http://www.linkedin.com/in/taotaoli"><i class="icon-linkedin-sign icon-large"></i><span> Profile</span></a>
      <a href="https://github.com/litaotao"><i class="icon-github icon-large"></i><span> Code</span></a>
      <a href="https://github.com/litaotao"><i class="icon-envelope-alt icon-large"></i><span> Mail</span></a>
    </center></div>
    <div id="menu"></div>
  </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

</body>
</html>
